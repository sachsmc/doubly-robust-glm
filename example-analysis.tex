% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  letterpaper,
  DIV=11,
  numbers=noendperiod]{scrartcl}

\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
% Make \paragraph and \subparagraph free-standing
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

\KOMAoption{captions}{tableheading}
\makeatletter
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\makeatletter
\@ifpackageloaded{tcolorbox}{}{\usepackage[many]{tcolorbox}}
\makeatother
\makeatletter
\@ifundefined{shadecolor}{\definecolor{shadecolor}{rgb}{.97, .97, .97}}
\makeatother
\makeatletter
\makeatother
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Example analysis},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\title{Example analysis}
\author{}
\date{}

\begin{document}
\maketitle
\ifdefined\Shaded\renewenvironment{Shaded}{\begin{tcolorbox}[enhanced, sharp corners, boxrule=0pt, borderline west={3pt}{0pt}{shadecolor}, breakable, frame hidden, interior hidden]}{\end{tcolorbox}}\fi

\hypertarget{linear-model-smoking-is-the-exposure-birthweight-in-grams-the-outcome}{%
\subsection{Linear model, smoking is the exposure, birthweight in grams
the
outcome}\label{linear-model-smoking-is-the-exposure-birthweight-in-grams-the-outcome}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{infunc\_confint }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(ofit, wfit, exposurename, outcomename) \{}
  
  
\NormalTok{  data }\OtherTok{\textless{}{-}}\NormalTok{ ofit}\SpecialCharTok{$}\NormalTok{data}
\NormalTok{  data1 }\OtherTok{\textless{}{-}}\NormalTok{ data0 }\OtherTok{\textless{}{-}}\NormalTok{ data}
\NormalTok{  data1[[exposurename]] }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{  data0[[exposurename]] }\OtherTok{\textless{}{-}} \DecValTok{0}
  
\NormalTok{  n }\OtherTok{\textless{}{-}} \FunctionTok{nrow}\NormalTok{(data1)}
  
\NormalTok{  est1f }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(}\FunctionTok{predict}\NormalTok{(ofit, }\AttributeTok{newdata =}\NormalTok{ data1, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{))}
\NormalTok{  est0f }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(}\FunctionTok{predict}\NormalTok{(ofit, }\AttributeTok{newdata =}\NormalTok{ data0, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{))}
  
  \CommentTok{\# refit using unweighted eeqs}
\NormalTok{  ofitunwt }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(ofit}\SpecialCharTok{$}\NormalTok{formula, }\AttributeTok{family =}\NormalTok{ ofit}\SpecialCharTok{$}\NormalTok{family, }
                 \AttributeTok{data =}\NormalTok{ data)}

\NormalTok{  phat }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(wfit, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}
 
  
\NormalTok{  est1 }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(ofitunwt, }\AttributeTok{newdata =}\NormalTok{ data1, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}
\NormalTok{  est0 }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(ofitunwt, }\AttributeTok{newdata =}\NormalTok{ data0, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}

\NormalTok{  XXw }\OtherTok{\textless{}{-}} \FunctionTok{model.matrix}\NormalTok{(wfit)}
\NormalTok{  XXo }\OtherTok{\textless{}{-}}\NormalTok{ XXo1 }\OtherTok{\textless{}{-}}\NormalTok{ XXo0 }\OtherTok{\textless{}{-}} \FunctionTok{model.matrix}\NormalTok{(ofitunwt)}
\NormalTok{  XXo1[,exposurename] }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{  XXo0[,exposurename] }\OtherTok{\textless{}{-}} \DecValTok{0}
  
\NormalTok{  ifweight }\OtherTok{\textless{}{-}} \FunctionTok{t}\NormalTok{(}\FunctionTok{vcov}\NormalTok{(wfit) }\SpecialCharTok{\%*\%} \FunctionTok{t}\NormalTok{(sandwich}\SpecialCharTok{::}\FunctionTok{estfun}\NormalTok{(wfit)))}
\NormalTok{  ifout }\OtherTok{\textless{}{-}} \FunctionTok{t}\NormalTok{(}\FunctionTok{vcov}\NormalTok{(ofit) }\SpecialCharTok{\%*\%} \FunctionTok{t}\NormalTok{(sandwich}\SpecialCharTok{::}\FunctionTok{estfun}\NormalTok{(ofitunwt)))}
  
  
\NormalTok{  eifterms1 }\OtherTok{\textless{}{-}}\NormalTok{ (data[[exposurename]] }\SpecialCharTok{/}\NormalTok{ phat }\SpecialCharTok{*}\NormalTok{ (data[[outcomename]] }\SpecialCharTok{{-}}\NormalTok{ est1) }\SpecialCharTok{+}\NormalTok{ (est1 }\SpecialCharTok{{-}}\NormalTok{ est1f)) }\SpecialCharTok{/}\NormalTok{ n}
\NormalTok{  eifterms0 }\OtherTok{\textless{}{-}}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ data[[exposurename]]) }\SpecialCharTok{/}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ phat) }\SpecialCharTok{*}\NormalTok{ (data[[outcomename]] }\SpecialCharTok{{-}}\NormalTok{ est0) }\SpecialCharTok{+}\NormalTok{ (est0 }\SpecialCharTok{{-}}\NormalTok{ est0f)) }\SpecialCharTok{/}\NormalTok{ n}
  
  
\NormalTok{  hdot }\OtherTok{\textless{}{-}} \FunctionTok{family}\NormalTok{(wfit)}\SpecialCharTok{$}\FunctionTok{mu.eta}\NormalTok{(}\FunctionTok{predict}\NormalTok{(wfit, }\AttributeTok{type =} \StringTok{"link"}\NormalTok{))}
  
\NormalTok{  gdot0 }\OtherTok{\textless{}{-}} \FunctionTok{family}\NormalTok{(ofit)}\SpecialCharTok{$}\FunctionTok{mu.eta}\NormalTok{(}\FunctionTok{predict}\NormalTok{(ofitunwt, }\AttributeTok{newdata =}\NormalTok{ data0, }\AttributeTok{type =} \StringTok{"link"}\NormalTok{))}
\NormalTok{  gdot1 }\OtherTok{\textless{}{-}} \FunctionTok{family}\NormalTok{(ofit)}\SpecialCharTok{$}\FunctionTok{mu.eta}\NormalTok{(}\FunctionTok{predict}\NormalTok{(ofitunwt, }\AttributeTok{newdata =}\NormalTok{ data1, }\AttributeTok{type =} \StringTok{"link"}\NormalTok{))}
  
\NormalTok{  Kterm1 }\OtherTok{\textless{}{-}}\NormalTok{ (}\SpecialCharTok{{-}}\DecValTok{1}\SpecialCharTok{/}\NormalTok{n) }\SpecialCharTok{*} \FunctionTok{matrix}\NormalTok{(((data[[exposurename]] }\SpecialCharTok{*}\NormalTok{ hdot) }\SpecialCharTok{/}\NormalTok{ phat}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{*} 
\NormalTok{                              (data[[outcomename]] }\SpecialCharTok{{-}}\NormalTok{ est1), }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{ncol =}\NormalTok{ n) }\SpecialCharTok{\%*\%}
\NormalTok{    XXw}
\NormalTok{  Kterm0 }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1}\SpecialCharTok{/}\NormalTok{n) }\SpecialCharTok{*} \FunctionTok{matrix}\NormalTok{((((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ data[[exposurename]]) }\SpecialCharTok{*}\NormalTok{ hdot) }\SpecialCharTok{/}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ phat)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{*} 
\NormalTok{                             (data[[outcomename]] }\SpecialCharTok{{-}}\NormalTok{ est0), }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{ncol =}\NormalTok{ n) }\SpecialCharTok{\%*\%}
\NormalTok{    XXw}
  
\NormalTok{  Lterm1 }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1}\SpecialCharTok{/}\NormalTok{ n) }\SpecialCharTok{*} \FunctionTok{matrix}\NormalTok{(gdot1 }\SpecialCharTok{*}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ data[[exposurename]]}\SpecialCharTok{/}\NormalTok{phat), }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{ncol =}\NormalTok{ n) }\SpecialCharTok{\%*\%} 
\NormalTok{    XXo1}
  
\NormalTok{  Lterm0 }\OtherTok{\textless{}{-}}\NormalTok{ (}\DecValTok{1}\SpecialCharTok{/}\NormalTok{ n) }\SpecialCharTok{*} \FunctionTok{matrix}\NormalTok{(gdot0 }\SpecialCharTok{*}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ data[[exposurename]])}\SpecialCharTok{/}\NormalTok{(}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ phat) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{), }\AttributeTok{nrow =} \DecValTok{1}\NormalTok{, }\AttributeTok{ncol =}\NormalTok{ n) }\SpecialCharTok{\%*\%} 
\NormalTok{    XXo0}
  
\NormalTok{  fullif1 }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(eifterms1, (ifweight }\SpecialCharTok{\%*\%} \FunctionTok{t}\NormalTok{(Kterm1)), (ifout }\SpecialCharTok{\%*\%} \FunctionTok{t}\NormalTok{(Lterm1)))}
\NormalTok{  fullif0 }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(eifterms0, (ifweight }\SpecialCharTok{\%*\%} \FunctionTok{t}\NormalTok{(Kterm0)), (ifout }\SpecialCharTok{\%*\%} \FunctionTok{t}\NormalTok{(Lterm0)))}
  
  
\NormalTok{  estse }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{(}\FunctionTok{sum}\NormalTok{((}\FunctionTok{rowSums}\NormalTok{(fullif1) }\SpecialCharTok{{-}} \FunctionTok{rowSums}\NormalTok{(fullif0))}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\NormalTok{  est }\OtherTok{\textless{}{-}}\NormalTok{ est1f }\SpecialCharTok{{-}}\NormalTok{ est0f}
  
  \FunctionTok{c}\NormalTok{(}\AttributeTok{lower =}\NormalTok{ est }\SpecialCharTok{{-}} \FloatTok{1.96} \SpecialCharTok{*}\NormalTok{ estse, }\AttributeTok{upper =}\NormalTok{ est }\SpecialCharTok{+} \FloatTok{1.96} \SpecialCharTok{*}\NormalTok{ estse)}
  
  
\NormalTok{\}}

\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ AF}\SpecialCharTok{::}\NormalTok{clslowbwt}
\FunctionTok{head}\NormalTok{(data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  id birth  smoke     race age lwt  bwt    low lbw smoker
1  1     1 1. Yes 3. Other  28 120 2865  0. No   0      1
2  1     2 1. Yes 3. Other  33 141 2609  0. No   0      1
3  2     1  0. No 1. White  29 130 2613  0. No   0      0
4  2     2  0. No 1. White  34 151 3125  0. No   0      0
5  2     3  0. No 1. White  37 144 2481 1. Yes   1      0
6  3     1 1. Yes 2. Black  31 187 1841 1. Yes   1      1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# propensity score fit}

\NormalTok{pwfit }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(smoker }\SpecialCharTok{\textasciitilde{}}\NormalTok{ race }\SpecialCharTok{*}\NormalTok{ age }\SpecialCharTok{*}\NormalTok{ lwt }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(age}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(lwt}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{), }\AttributeTok{data =}\NormalTok{ data, }
             \AttributeTok{family =} \StringTok{"binomial"}\NormalTok{)}
\NormalTok{phat }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(pwfit, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}

\NormalTok{data}\SpecialCharTok{$}\NormalTok{weight }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{smoker }\SpecialCharTok{/}\NormalTok{ phat }\SpecialCharTok{+}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{smoker) }\SpecialCharTok{/}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ phat)}
\DocumentationTok{\#\# outcome model}

\NormalTok{outfit }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(bwt }\SpecialCharTok{\textasciitilde{}}\NormalTok{ smoker }\SpecialCharTok{*}\NormalTok{ (race }\SpecialCharTok{+}\NormalTok{ age }\SpecialCharTok{+}\NormalTok{ lwt) }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(age}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(lwt}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{), }
              \AttributeTok{data =}\NormalTok{ data, }\AttributeTok{family =} \StringTok{"gaussian"}\NormalTok{, }\AttributeTok{weights =}\NormalTok{ weight)}

\DocumentationTok{\#\# dummy data, where we set X to 0 and 1}

\NormalTok{data0 }\OtherTok{\textless{}{-}}\NormalTok{ data1 }\OtherTok{\textless{}{-}}\NormalTok{ data}
\NormalTok{data0}\SpecialCharTok{$}\NormalTok{smoker }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{data1}\SpecialCharTok{$}\NormalTok{smoker }\OtherTok{\textless{}{-}} \DecValTok{1}

\DocumentationTok{\#\# predicted couterfactuals}
\NormalTok{Yhat0 }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(outfit, }\AttributeTok{newdata =}\NormalTok{ data0, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}
\NormalTok{Yhat1 }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(outfit, }\AttributeTok{newdata =}\NormalTok{ data1, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}

\NormalTok{ATEmean }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(Yhat1) }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(Yhat0)}
\NormalTok{ATEmean}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -223.6736
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{infunc\_confint}\NormalTok{(outfit, pwfit, }\StringTok{"smoker"}\NormalTok{, }\StringTok{"bwt"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      lower       upper 
-446.081852   -1.265258 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# CAN Richard Funk?}

\DocumentationTok{\#\# separate outcome models, unweighted}

\NormalTok{ofit1 }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(bwt }\SpecialCharTok{\textasciitilde{}}\NormalTok{ (race }\SpecialCharTok{+}\NormalTok{ age }\SpecialCharTok{+}\NormalTok{ lwt) }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(age}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(lwt}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{), }
              \AttributeTok{data =} \FunctionTok{subset}\NormalTok{(data, smoker }\SpecialCharTok{==} \DecValTok{1}\NormalTok{), }\AttributeTok{family =} \StringTok{"gaussian"}\NormalTok{)}

\NormalTok{ofit0 }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(bwt }\SpecialCharTok{\textasciitilde{}}\NormalTok{ (race }\SpecialCharTok{+}\NormalTok{ age }\SpecialCharTok{+}\NormalTok{ lwt) }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(age}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(lwt}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{), }
              \AttributeTok{data =} \FunctionTok{subset}\NormalTok{(data, smoker }\SpecialCharTok{==} \DecValTok{0}\NormalTok{), }\AttributeTok{family =} \StringTok{"gaussian"}\NormalTok{)}


\NormalTok{dr1 }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{bwt }\SpecialCharTok{*}\NormalTok{ (data}\SpecialCharTok{$}\NormalTok{smoker }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ phat }\SpecialCharTok{{-}} 
  \FunctionTok{predict}\NormalTok{(ofit1, }\AttributeTok{newdata =}\NormalTok{ data1, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{) }\SpecialCharTok{*} 
\NormalTok{  ((data}\SpecialCharTok{$}\NormalTok{smoker }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{{-}}\NormalTok{ phat) }\SpecialCharTok{/}\NormalTok{ phat}
\NormalTok{dr0 }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{bwt }\SpecialCharTok{*}\NormalTok{ (data}\SpecialCharTok{$}\NormalTok{smoker }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ phat) }\SpecialCharTok{+} 
  \FunctionTok{predict}\NormalTok{(ofit0, }\AttributeTok{newdata =}\NormalTok{ data0, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{) }\SpecialCharTok{*} 
\NormalTok{  ((data}\SpecialCharTok{$}\NormalTok{smoker }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{{-}}\NormalTok{ phat) }\SpecialCharTok{/}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ phat)}

\NormalTok{ATEfunk }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(dr1) }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(dr0)  }
\NormalTok{ATEfunk}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -225.5489
\end{verbatim}

Bootstrap for confidence interval, not echoed

\begin{verbatim}
      2.5%      97.5% 
-387.12347  -46.48662 
\end{verbatim}

\hypertarget{logistic-model-smoking-is-the-exposure-low-birthweight-birth-weight-2500g-the-outcome}{%
\subsection{Logistic model, smoking is the exposure, low birthweight
(birth weight \textless{} 2500g) the
outcome}\label{logistic-model-smoking-is-the-exposure-low-birthweight-birth-weight-2500g-the-outcome}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# propensity score fit}

\NormalTok{pwfit }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(smoker }\SpecialCharTok{\textasciitilde{}}\NormalTok{ race }\SpecialCharTok{*}\NormalTok{ age }\SpecialCharTok{*}\NormalTok{ lwt }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(age}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(lwt}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{), }\AttributeTok{data =}\NormalTok{ data, }
             \AttributeTok{family =} \StringTok{"binomial"}\NormalTok{)}
\NormalTok{phat }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(pwfit, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}

\NormalTok{data}\SpecialCharTok{$}\NormalTok{weight }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{smoker }\SpecialCharTok{/}\NormalTok{ phat }\SpecialCharTok{+}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{smoker) }\SpecialCharTok{/}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ phat)}
\DocumentationTok{\#\# outcome model}

\NormalTok{outfit }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(lbw }\SpecialCharTok{\textasciitilde{}}\NormalTok{ smoker }\SpecialCharTok{*}\NormalTok{ (race }\SpecialCharTok{+}\NormalTok{ age }\SpecialCharTok{+}\NormalTok{ lwt) }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(age}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(lwt}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{), }
              \AttributeTok{data =}\NormalTok{ data, }\AttributeTok{family =} \StringTok{"binomial"}\NormalTok{, }\AttributeTok{weights =}\NormalTok{ weight)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Warning in eval(family$initialize): non-integer #successes in a binomial glm!
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# dummy data, where we set X to 0 and 1}

\NormalTok{data0 }\OtherTok{\textless{}{-}}\NormalTok{ data1 }\OtherTok{\textless{}{-}}\NormalTok{ data}
\NormalTok{data0}\SpecialCharTok{$}\NormalTok{smoker }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{data1}\SpecialCharTok{$}\NormalTok{smoker }\OtherTok{\textless{}{-}} \DecValTok{1}

\DocumentationTok{\#\# predicted couterfactuals}
\NormalTok{Yhat0 }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(outfit, }\AttributeTok{newdata =}\NormalTok{ data0, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}
\NormalTok{Yhat1 }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(outfit, }\AttributeTok{newdata =}\NormalTok{ data1, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{)}

\NormalTok{ATEmean }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(Yhat1) }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(Yhat0)}
\NormalTok{ATEmean}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.134932
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{infunc\_confint}\NormalTok{(outfit, pwfit, }\StringTok{"smoker"}\NormalTok{, }\StringTok{"lbw"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       lower        upper 
0.0009662041 0.2688977028 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{RRmean }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(Yhat1) }\SpecialCharTok{/} \FunctionTok{mean}\NormalTok{(Yhat0)}
\NormalTok{RRmean}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.478392
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# separate outcome models, unweighted}

\NormalTok{ofit1 }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(lbw }\SpecialCharTok{\textasciitilde{}}\NormalTok{ (race }\SpecialCharTok{+}\NormalTok{ age }\SpecialCharTok{+}\NormalTok{ lwt) }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(age}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(lwt}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{), }
              \AttributeTok{data =} \FunctionTok{subset}\NormalTok{(data, smoker }\SpecialCharTok{==} \DecValTok{1}\NormalTok{), }\AttributeTok{family =} \StringTok{"binomial"}\NormalTok{)}

\NormalTok{ofit0 }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(lbw }\SpecialCharTok{\textasciitilde{}}\NormalTok{ (race }\SpecialCharTok{+}\NormalTok{ age }\SpecialCharTok{+}\NormalTok{ lwt) }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(age}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{I}\NormalTok{(lwt}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{), }
              \AttributeTok{data =} \FunctionTok{subset}\NormalTok{(data, smoker }\SpecialCharTok{==} \DecValTok{0}\NormalTok{), }\AttributeTok{family =} \StringTok{"binomial"}\NormalTok{)}


\NormalTok{dr1 }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{lbw }\SpecialCharTok{*}\NormalTok{ (data}\SpecialCharTok{$}\NormalTok{smoker }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ phat }\SpecialCharTok{{-}} 
  \FunctionTok{predict}\NormalTok{(ofit1, }\AttributeTok{newdata =}\NormalTok{ data1, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{) }\SpecialCharTok{*} 
\NormalTok{  ((data}\SpecialCharTok{$}\NormalTok{smoker }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{{-}}\NormalTok{ phat) }\SpecialCharTok{/}\NormalTok{ phat}
\NormalTok{dr0 }\OtherTok{\textless{}{-}}\NormalTok{ data}\SpecialCharTok{$}\NormalTok{lbw }\SpecialCharTok{*}\NormalTok{ (data}\SpecialCharTok{$}\NormalTok{smoker }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ phat) }\SpecialCharTok{+} 
  \FunctionTok{predict}\NormalTok{(ofit0, }\AttributeTok{newdata =}\NormalTok{ data0, }\AttributeTok{type =} \StringTok{"response"}\NormalTok{) }\SpecialCharTok{*} 
\NormalTok{  ((data}\SpecialCharTok{$}\NormalTok{smoker }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{{-}}\NormalTok{ phat) }\SpecialCharTok{/}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ phat)}

\NormalTok{ATEfunk }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(dr1) }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(dr0)  }
\NormalTok{RRfunk }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(dr1) }\SpecialCharTok{/} \FunctionTok{mean}\NormalTok{(dr0)}
\NormalTok{ATEfunk}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.1372512
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{RRfunk}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.488187
\end{verbatim}

Bootstrap for confidence interval, not echoed

\begin{verbatim}
     2.5%     97.5% 
0.0279252 0.2411590 
\end{verbatim}

\begin{verbatim}
    2.5%    97.5% 
1.082286 2.004029 
\end{verbatim}



\end{document}
